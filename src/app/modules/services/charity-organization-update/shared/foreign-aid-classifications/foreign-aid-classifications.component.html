<form class="row" [formGroup]="form">
  <div *ngFor="let control of controls" class="col-sm-6 col-md-4 mb-4 position-relative"
       [ngSwitch]="control.type">
    <ng-container *ngSwitchCase="'dropdown'">
      <div>
        <label [asteriskIfRequired]="control.controlName" [for]="control.controlName"
               class="form-label">{{ control.label }}</label>
        <ng-select [readonly]="readonly || hideSave"
                   [selectOnTab]="true"
                   [labelForId]="control.controlName"
                   [clearable]="true"
                   placeholder="{{ lang.map.select }}"
                   [id]="control.controlName"
                   [notFoundText]="lang.map.msg_not_found"
                   appendTo="body"
                   [validationClasses]="control.controlName"
                   [formControlName]="control.controlName"
                   (change)="control.onChange?.($event)">
          <ng-option *ngFor="let type of control.load ? control.load : (control.load$ | async)"
                     [disabled]="(control.dropdownOptionDisabled && control.dropdownOptionDisabled(type)) ?? false"
                     [value]="type[control.dropdownValue!]">{{ type.getName() }}</ng-option>
        </ng-select>
        <app-field-error-message [controlName]="control.controlName"></app-field-error-message>
      </div>
    </ng-container>
    <ng-container *ngSwitchCase="'text'">
      <label
        [asteriskIfRequired]="control.controlName"
        [for]="control.controlName"
        class="form-label"
        [validationClasses]="control.controlName"
      >{{ control.label }}</label
      >
      <input
        type="text"
        [readonly]="readonly || hideSave"
        class="form-control"
        [id]="control.controlName"
        [formControlName]="control.controlName"
      />

      <app-field-error-message
        [controlName]="control.controlName"
      ></app-field-error-message>
    </ng-container>
  </div>

  <div class="d-flex flex-row align-items-center justify-content-center">
    <button
      (click)="save()"
      [disabled]="!form.valid"
      *ngIf="!hideSave"
      class="btn btn-primary m-2"
    >
      {{ editRecordIndex > -1 ? lang.map.btn_update : lang.map.btn_add }}
    </button>
    <button (click)="cancel()" class="btn btn-secondary m-2">
      {{ lang.map.btn_cancel }}
    </button>
  </div>
</form>
<hr>
<div class="row">
  <div class="col-12">
    <h6 class="h6 text-primary">
      {{ lang.map.classification_of_foreign_aid }}
    </h6>
  </div>
  <div class="col-12">
    <app-table
      #table
      [useSearchToFilter]="true"
      [selectable]="true"
      [data]="_list"
      [columns]="columns"
      sortableTable
    >
      <table
        cdk-table
        [dataSource]="table.dataSource"
        class="table table-striped table-bordered caption-top"
      >
        <ng-container cdkColumnDef="aidClassification">
          <th cdk-header-cell sortable-header *cdkHeaderCellDef>
            {{ lang.map.internal_aid_calssification }}
          </th>
          <td cdk-cell *cdkCellDef="let row">
            {{ row?.aidClassificationInfo?.getName() || row.aidClassification }}
          </td>
        </ng-container>

        <ng-container cdkColumnDef="domain">
          <th cdk-header-cell sortable-header *cdkHeaderCellDef>
            {{ lang.map.domain }}
          </th>
          <td cdk-cell *cdkCellDef="let row">
            {{ row?.domainInfo?.getName() || row.domain }}
          </td>
        </ng-container>

        <ng-container cdkColumnDef="mainUNOCHACategory">
          <th cdk-header-cell sortable-header *cdkHeaderCellDef>
            {{ lang.map.main_unocha_category }}
          </th>
          <td cdk-cell *cdkCellDef="let row">
            {{
            row?.mainUNOCHACategoryInfo?.getName() || row.mainUNOCHACategory
            }}
          </td>
        </ng-container>

        <ng-container cdkColumnDef="subUNOCHACategory">
          <th cdk-header-cell sortable-header *cdkHeaderCellDef>
            {{ lang.map.sub_unocha_category }}
          </th>
          <td cdk-cell *cdkCellDef="let row">
            {{ row?.subUNOCHACategoryInfo?.getName() || row.subUNOCHACategory }}
          </td>
        </ng-container>

        <ng-container cdkColumnDef="mainDACCategory">
          <th cdk-header-cell sortable-header *cdkHeaderCellDef>
            {{ lang.map.main_dac_category }}
          </th>
          <td cdk-cell *cdkCellDef="let row">
            {{ row?.mainDACCategoryInfo?.getName() || row.mainDACCategory }}
          </td>
        </ng-container>
        <ng-container cdkColumnDef="subDACCategory">
          <th cdk-header-cell sortable-header *cdkHeaderCellDef>
            {{ lang.map.sub_dac_category }}
          </th>
          <td cdk-cell *cdkCellDef="let row">
            {{ row?.subDACCategoryInfo?.getName() || row.subDACCategory }}
          </td>
        </ng-container>

        <ng-container cdkColumnDef="actions">
          <th cdk-header-cell *cdkHeaderCellDef>{{ lang.map.lbl_actions }}</th>
          <td cdk-cell *cdkCellDef="let row; index as itemIndex" class="table-actions">
            <grid-actions [record]="row" [actions]="actions" [itemIndex]="itemIndex">
            </grid-actions>
          </td>
        </ng-container>
        <tr cdk-header-row *cdkHeaderRowDef="columns"></tr>
        <tr cdk-row *cdkRowDef="let row; columns: columns"></tr>
        <tr *cdkNoDataRow>
          <td colspan="100" class="text-center">
            {{ lang.map.no_records_to_display }}
          </td>
        </tr>
      </table>
    </app-table>
  </div>
</div>
