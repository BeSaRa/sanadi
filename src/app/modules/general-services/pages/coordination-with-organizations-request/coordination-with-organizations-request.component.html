<div class="d-flex flex-column">
  <form [formGroup]="form" autocomplete="off">
    <tabs-list [accordionView]="accordionView">
      <tab *ngIf="true" [name]="tabsData.basicInfo.name" [hasError]="getTabInvalidStatus('basicInfo')"
        [template]="basicInfoTabTemplate" [title]="lang.map.lbl_basic_info"></tab>

      <tab *ngIf="true" [name]="tabsData.specialExplanation.name" [hasError]="getTabInvalidStatus('specialExplanation')"
        [template]="specialExplanationTab" [title]="lang.map.special_explanations">
      </tab>

      <tab *ngIf="true" [name]="tabsData.participantOrganizations.name" [template]="participating_organizaions"
        [title]="lang.map.participant_organizations" [hasError]="getTabInvalidStatus('participantOrganizations')">
      </tab>

      <tab *ngIf="!isInternalUser" [name]="tabsData.organizationOfficers.name" [template]="organization_officers"
        [title]="lang.map.organization_officers" [hasError]="getTabInvalidStatus('organizationOfficers')">
      </tab>
      <tab *ngIf="!isInternalUser && isCorrectModelToDisplay(1)" [name]="tabsData.buildingAbilities.name"
        [template]="building_abilities" [title]="lang.map.building_abilities"
        [hasError]="getTabInvalidStatus('buildingAbilities')">
      </tab>
      <tab *ngIf="!isInternalUser && isCorrectModelToDisplay(2)"
        [name]="tabsData.effectiveCoordinationCapabilities.name" [template]="effective_coordination_capabilities"
        [title]="lang.map.effective_coordination_capabilities"
        [hasError]="getTabInvalidStatus('effectiveCoordinationCapabilities')">
      </tab>
      <tab *ngIf="!isInternalUser && isCorrectModelToDisplay(3)" [name]="tabsData.researchAndStudies.name"
        [template]="research_and_studies" [title]="lang.map.research_and_studies"
        [hasError]="getTabInvalidStatus('researchAndStudies')">
      </tab>

    </tabs-list>

    <ng-template #basicInfoTabTemplate>
      <fieldset [disabled]="!isEditAllowed()">

        <div class="row mb-4">
          <!-- Full Name -->
          <div class="col-sm-12 col-md-6 mb-6 position-relative">
            <label asteriskIfRequired="fullName" for="fullName" class="form-label">{{lang.map.full_name}}</label>
            <input id="fullName" validationClasses="fullName" [value]="model?.fullName" formControlName="fullName"
              trimInput class="form-control">
            <app-field-error-message controlName="fullName"></app-field-error-message>
          </div>
          <!-- Domain -->
          <div class="col-12 col-md-6 mb-6 position-relative">
            <label asteriskIfRequired="domain" for="domain" class="form-label">{{ lang.map.domain }}</label>
            <ng-select [selectOnTab]="true" placeholder="{{ lang.map.select }}" [readonly]="!isEditAllowed()"
              [notFoundText]="lang.map.msg_not_found" appendTo="body" id="domain" validationClasses="domain"
              formControlName="domain">
              <ng-option *ngFor="let option of domains" [value]="option.lookupKey">{{ option.getName() }}</ng-option>
            </ng-select>
            <app-field-error-message controlName="domain"></app-field-error-message>
          </div>

        </div>

        <!-- License Start Date -->
        <div class="row">
          <div class="col-12 col-md-6 mb-6 position-relative">
            <label for="licenseStartDate" asteriskIfRequired="licenseStartDate"
              class="form-label">{{lang.map.license_start_date}}</label>
            <div class="input-group">
              <i class="input-group-text mdi mdi-calendar"></i>
              <div class="form-control" formControlName="licenseStartDate" id="licenseStartDate"
                [options]="datepickerOptionsMap.licenseStartDate" [ngClass]="{'input-disabled': !isEditAllowed()}"
                (click)="openDateMenu(dpLicenseStartDate)"
                (inputFieldChanged)="onDateChange($event, 'licenseStartDate', 'licenseEndDate')"
                #dpLicenseStartDate="angular-mydatepicker" angular-mydatepicker validationClasses="licenseStartDate">
              </div>
              <app-field-error-message controlName="licenseStartDate"></app-field-error-message>
            </div>
          </div>
          <!-- License End Date -->
          <div class="col-12 col-md-6 mb-6 position-relative">
            <label for="licenseEndDate" asteriskIfRequired="licenseEndDate"
              class="form-label">{{lang.map.license_end_date}}</label>
            <div class="input-group">
              <i class="input-group-text mdi mdi-calendar"></i>
              <div class="form-control" formControlName="licenseEndDate" id="licenseEndDate"
                [options]="datepickerOptionsMap.licenseEndDate" [ngClass]="{'input-disabled': !isEditAllowed()}"
                (click)="openDateMenu(dpLicenseEndDate)"
                (inputFieldChanged)="onDateChange($event, 'licenseStartDate', 'licenseEndDate')"
                #dpLicenseEndDate="angular-mydatepicker" angular-mydatepicker validationClasses="licenseEndDate"></div>
              <app-field-error-message controlName="licenseEndDate"></app-field-error-message>
            </div>
          </div>

        </div>
      </fieldset>
    </ng-template>

    <ng-template #specialExplanationTab>
      <div class="row">
        <div class="col-sm-12 mb-4 position-relative">
          <label class="form-label" asteriskIfRequired="description"
            for="description">{{lang.map.special_explanations}}</label>
          <textarea name="description" formControlName="description" validationClasses="description" id="description"
            rows="4" class="form-control" [readOnly]="(readonly)"
            [maxlength]="customValidators.defaultLengths.EXPLANATIONS"></textarea>
          <app-field-error-message controlName="description"></app-field-error-message>
        </div>
      </div>
    </ng-template>
    <ng-template #participating_organizaions>
      <participant-organization #participantOrganizations [list]="model?.participatingOrganizaionList || []"
        [organizationUnits]="organizationUnits" (readyEvent)="participantOrganizationsTapStatus = $event"
        [canAdd]="paticipatingOrgsCanAdd"
        [canView]="paticipatingOrgsCanView"
        [canDelete]="paticipatingOrgsCanDelete"
        (listUpdated)="updateParticipantOrgs()"
        (requestView)="openParticipantOrgPopup($event)"
        >

      </participant-organization>
    </ng-template>
    <ng-template #organization_officers>
      <organizaion-officer #organizationOfficersTap [list]="model?.organizaionOfficerList || []"

        [organizationUsers]="organizationUsers" (readyEvent)="organizationOfficersTabStatus = $event"
        [canUpdate]="isCharityUser" [isClaimed]="model?.isClaimed()?? true" [currentUserOrgId]="currentUserOrgId">
      </organizaion-officer>

    </ng-template>



    <ng-template #building_abilities>
      <building-ability #buildingAbilityTap [list]="model?.buildingAbilitiesList || []"
        [organizationUnits]="organizationUnits" [trainingTypes]="trainingTypes"
        [orgId]="currentUserOrgId"
        [trainingLanguages]="trainingLanguages"
        [trainingWayes]="trainingWayes" [recommendedWayes]="recommendedWayes" [readonly]=" isEditAllowed()"
        (readyEvent)="buildingAbilityTabStatus = $event" [canUpdate]="isCharityUser" [isClaimed]="model?.isClaimed()?? true">
      </building-ability>
    </ng-template>
    <ng-template #effective_coordination_capabilities>
      <effective-coordination-capabilities #effectiveCoordinationCapabilitiesTap
        [list]="model?.effectiveCoordinationCapabilities || []" [organizationWayes]="organizationWayes"
        [organizationUnits]="organizationUnits" [readonly]=" isEditAllowed()" [canUpdate]="isCharityUser"
        [orgId]="currentUserOrgId"
        [isClaimed]="model?.isClaimed()?? true" (readyEvent)="effectiveCoordinationCapabilitiesTabStatus = $event">
      </effective-coordination-capabilities>
    </ng-template>

    <ng-template #research_and_studies>
      <app-research-and-studies #researchAndStudiesTap [list]="model?.researchAndStudies || []"
        [readonly]=" isEditAllowed()" (readyEvent)="ResearchAndStudiesTabStatus = $event"
        [orgId]="currentUserOrgId"
        [canUpdate]="isCharityUser"
        [isClaimed]="model?.isClaimed()?? true">
      </app-research-and-studies>
    </ng-template>

  </form>
</div>
