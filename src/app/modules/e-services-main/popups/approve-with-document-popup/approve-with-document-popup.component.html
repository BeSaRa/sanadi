<div class="dialog-toolbar bg-primary dialog-toolbar d-flex justify-content-between">
  <h1 class="h6 text-white">{{ lang.map.org_approve_task }}</h1>
  <button type="button" class="btn-close btn-close-white" tabindex="-1" dialogClose aria-label="Close"></button>
</div>
<div class="dialog-content no-fixed-height w800px">
  <div>
    <div class="row pb-3">
      <app-page-header [customTemplate]="headerTemplate"></app-page-header>
      <ng-template #headerTemplate>
        <div class="align-items-center">
          <h1 class="h6 text-primary m-0 d-inline-block">{{lang.map.attachments}}</h1>
          <button class="btn btn-link outline-none" tooltip="{{ lang.map.btn_add }}"
            (click)="addOtherAttachments.next()">
            <i class="mdi mdi-plus-box"></i>
          </button>

        </div>
      </ng-template>
    </div>

    <app-table [selectable]="true" #table sortableTable [data]="attachments" [columns]="displayedColumns">
      <table cdk-table [dataSource]="table.dataSource" class="table table-striped table-bordered caption-top">
        <ng-container cdkColumnDef="rowSelection">
          <th cdk-header-cell class="bg-primary" style="width: 20px;" *cdkHeaderCellDef>
            <input type="checkbox" [disabled]="table.filter"
              [indeterminate]="table.selection.hasValue() && !table.allSelected()"
              (change)="$event ? table.toggleAll() : null" [checked]="table.selection.hasValue() && table.allSelected()"
              class="form-check-input">
          </th>
          <td cdk-cell *cdkCellDef="let row">
            <input type="checkbox" (click)="$event.stopPropagation()" [checked]="table.selection.isSelected(row)"
              (change)="$event ? table.selection.toggle(row) : null" class="form-check-input">
          </td>
        </ng-container>
        <ng-container cdkColumnDef="title">
          <th cdk-header-cell class="bg-primary text-white" style="width: 20px;" *cdkHeaderCellDef></th>
          <td cdk-cell *cdkCellDef="let row"><i class="mdi text-primary {{fileIconsEnum.PDF}}"></i></td>
        </ng-container>
        <ng-container cdkColumnDef="type">
          <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.attachment_type}}</th>
          <td cdk-cell *cdkCellDef="let row"> {{row.attachmentTypeInfo.getName()}} </td>
        </ng-container>
        <ng-container cdkColumnDef="description">
          <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.lbl_description}}</th>
          <td cdk-cell *cdkCellDef="let row"> {{row.description}} </td>
        </ng-container>
        <ng-container cdkColumnDef="mandatory">
          <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.lbl_mandatory}}</th>
          <td cdk-cell *cdkCellDef="let row"> {{row.getRequiredTranslate()}} </td>
        </ng-container>

        <ng-container cdkColumnDef="date">
          <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.creation_date}}</th>
          <td cdk-cell *cdkCellDef="let row"> {{row.createdOn|date: 'mediumDate' }} </td>
        </ng-container>
        <ng-container cdkColumnDef="actions">
          <th cdk-header-cell style="width: 200px" class="bg-primary text-white" *cdkHeaderCellDef>
            {{lang.map.lbl_actions}}</th>
          <td cdk-cell *cdkCellDef="let row; index as itemIndex">
            <div class="d-flex gap-2">
              <button [tooltip]="row.id ? lang.map.update_file : lang.map.upload_file"
                (click)="uploadAttachment(row , uploader)" [class.btn-success]="row.id"
                class="btn btn-sm shadow-sm btn-secondary d-flex align-items-center justify-content-start">
                <i [class.mdi-progress-upload]="row.id" [class.mdi-upload]="!row.id" class="mdi mdi-upload"></i>
              </button>
              <button [tooltip]="lang.map.view" (click)="viewFile(row)" [disabled]="!row.id"
                class="btn btn-sm shadow-sm btn-info d-flex align-items-center justify-content-start">
                <i [class.mdi-eye-off]="!row.id" [class.mdi-eye]="row.id" class="mdi text-white"></i>
              </button>
              <button [tooltip]="lang.map.btn_delete" (click)="deleteFile(row)" [disabled]="!row.id"
                class="btn btn-sm shadow-sm btn-danger d-flex align-items-center justify-content-start">
                <i [class.mdi-delete-off]="!row.id" [class.mdi-delete]="row.id" class="mdi"></i>
              </button>
            </div>
          </td>
        </ng-container>
        <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
        <tr cdk-row *cdkRowDef="let row; columns: displayedColumns;"></tr>
        <tr *cdkNoDataRow>
          <td colspan="100" class="text-center">{{lang.map.no_records_to_display}}</td>
        </tr>
      </table>
    </app-table>
    <input type="file" (change)="uploaderFileChange($event)" #uploader id="attachmentUploader" class="visually-hidden"
      [accept]="allowedExtensions.join(',')">

    <div class="col-sm-12 mb-4 position-relative">
      <label class="form-label" asteriskIfRequired [control]="comment" for="comment">{{lang.map.comment}}</label>
      <textarea name="comment" [formControl]="comment" validationClasses [control]="comment" id="comment" rows="4"
        class="form-control"></textarea>
      <app-field-error-message [control]="comment"></app-field-error-message>
    </div>
  </div>

  <div class="dialog-actions">
    <button class="btn btn-primary" (click)="action$.next(null)">
      {{ lang.map.approve_task }}
    </button>
    <button dialogClose class="btn btn-secondary">
      {{ lang.map.btn_close }}
    </button>
  </div>
