<div class="dialog-toolbar bg-primary align-items-center dialog-toolbar d-flex ">
  <h1 class="h6 text-white">
    {{operation === operationTypes.CREATE ? lang.map.add_new_internal_user : lang.map.edit_internal_user}}
  </h1>
  <span class="flex-grow-1"></span>
  <button type="button" class="btn btn-fullscreen btn-close-white icon-btn"
          tabindex="-1" aria-label="Fullscreen" fullscreenBtn></button>
  <button type="button" class="btn-close btn-close-white"
          tabindex="-1" dialogClose aria-label="Close"></button>
</div>
<div class="dialog-content" #content style="width: 800px">
  <tabs-list>
    <tab [hasError]="basicInfoHasError()" [template]="basicInfoTab" [title]="lang.map.lbl_basic_info"></tab>
    <tab [hasError]="permissionTabHasError()" [template]="permissionsTab" [title]="lang.map.lbl_permissions"></tab>
    <tab [title]="lang.map.link_teams" [template]="teamsTab"></tab>
    <tab [title]="lang.map.link_services"></tab>
  </tabs-list>
  <ng-template #basicInfoTab>
    <form [formGroup]="form" novalidate>
      <ng-container formGroupName="user">
        <div class="row">
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="arName" for="arName">{{lang.map.arabic_name}}</label>
            <input validationClasses="arName" formControlName="arName" type="text" id="arName" class="form-control">
            <app-field-error-message controlName="arName"></app-field-error-message>
          </div>
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="enName" for="enName">{{lang.map.english_name}}</label>
            <input validationClasses="enName" formControlName="enName" type="text" id="enName" class="form-control">
            <app-field-error-message controlName="enName"></app-field-error-message>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="domainName" for="domainName">{{lang.map.login_name}}</label>
            <input validationClasses="domainName" formControlName="domainName" type="text" id="domainName"
                   class="form-control">
            <app-field-error-message controlName="domainName"></app-field-error-message>
          </div>
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="empNum" for="empNum">{{lang.map.lbl_employee_number}}</label>
            <input validationClasses="empNum" formControlName="empNum" type="text" id="empNum" class="form-control">
            <app-field-error-message controlName="empNum"></app-field-error-message>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="defaultDepartmentId"
                   for="defaultDepartmentId">{{lang.map.default_dep}}</label>
            <ng-select validationClasses="defaultDepartmentId" appendTo="body" [clearable]="true"
                       id="defaultDepartmentId"
                       formControlName="defaultDepartmentId">
              <ng-option [value]="dep.id" *ngFor="let dep of departments">{{dep.getName()}}</ng-option>
            </ng-select>
            <app-field-error-message controlName="defaultDepartmentId"></app-field-error-message>
          </div>
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="jobTitle"
                   for="jobTitle">{{lang.map.job_title}}</label>
            <ng-select validationClasses="jobTitle" appendTo="body" [clearable]="true" id="jobTitle"
                       formControlName="jobTitle">
              <ng-option [value]="title.id" *ngFor="let title of jobTitles">{{title.getName()}}</ng-option>
            </ng-select>
            <app-field-error-message controlName="jobTitle"></app-field-error-message>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="email" for="email">{{lang.map.lbl_email}}</label>
            <input validationClasses="email" formControlName="email" type="text" id="email" class="form-control">
            <app-field-error-message controlName="email"></app-field-error-message>
          </div>
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="officialPhoneNumber"
                   for="officialPhoneNumber">{{lang.map.official_phone_number}}</label>
            <input validationClasses="officialPhoneNumber" formControlName="officialPhoneNumber" type="text"
                   id="officialPhoneNumber" class="form-control">
            <app-field-error-message controlName="officialPhoneNumber"></app-field-error-message>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="phoneNumber"
                   for="phoneNumber">{{lang.map.mobile_number}}</label>
            <input validationClasses="phoneNumber" formControlName="phoneNumber" type="text" id="phoneNumber"
                   class="form-control">
            <app-field-error-message controlName="phoneNumber"></app-field-error-message>
          </div>
          <div class="col-md-6 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="status" for="status">{{lang.map.lbl_status}}</label>
            <ng-select [selectOnTab]="true" labelForId="status" [clearable]="false"
                       placeholder="{{lang.map.select}}" id="status"
                       [notFoundText]="lang.map.msg_not_found"
                       formControlName="status" validationClasses="status">
              <ng-option value="">{{lang.map.lbl_none}}</ng-option>
              <ng-option *ngFor="let option of statusList" [value]="option.lookupKey"
                         [disabled]="option.isRetiredCommonStatus()">
                {{option.getName()}}
              </ng-option>
            </ng-select>
            <app-field-error-message controlName="status"></app-field-error-message>
          </div>
        </div>
      </ng-container>
    </form>
  </ng-template>
  <ng-template #permissionsTab>
    <ng-container [formGroup]="form">
      <div formGroupName="userPermissions" class="row">
        <div class="col-sm-6 mb-4 position-relative ng-select-wrapper">
          <label for="customRoleId" asteriskIfRequired="customRoleId"
                 class="form-label">{{lang.map.lbl_custom_role}}</label>
          <ng-select [selectOnTab]="true" labelForId="customRoleId" [clearable]="false"
                     placeholder="{{lang.map.select}}" id="customRoleId"
                     [notFoundText]="lang.map.msg_not_found"
                     formControlName="customRoleId"
                     (change)="onCustomRoleChange()">
            <ng-option value="">{{lang.map.lbl_none}}</ng-option>
            <ng-option *ngFor="let option of customRoles" [value]="option.id"
                       [disabled]="!option.status">
              {{option.getName()}}
            </ng-option>
          </ng-select>
        </div>
      </div>
    </ng-container>
    <div *ngIf="customRoleId?.value" class="row">
      <div *ngFor="let checkBoxGroup of permissionGroups" class="col-sm-12 mb-2">
        <div class="p-2 border border-1">
          <div class="form-check mb-2 pb-2 border-bottom">
            <input [indeterminate]="checkBoxGroup.isIndeterminate()" [checked]="checkBoxGroup.isFull()"
                   type="checkbox"
                   id="group-id-{{checkBoxGroup.group.id}}" (change)="groupHandler.onGroupClicked(checkBoxGroup)"
                   class="form-check-input cursor-pointer">
            <label for="group-id-{{checkBoxGroup.group.id}}"
                   class="cursor-pointer">{{checkBoxGroup.group.getName()}}</label>
          </div>
          <div *ngFor="let row of checkBoxGroup.rows" class="row mx-2">
            <div *ngFor="let permission of row" class="form-check col-sm-12 col-md-4">
              <input type="checkbox" [checked]="checkBoxGroup.isSelected(permission.id)" [value]="permission.id"
                     id="group-permission-id-{{permission.id}}"
                     (change)="groupHandler.onCheckBoxClicked(permission , $event , checkBoxGroup)"
                     class="form-check-input cursor-pointer">
              <label for="group-permission-id-{{permission.id}}"
                     class="cursor-pointer">{{permission.getName()}}</label>
            </div>
          </div>

        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #teamsTab>
    <div class="row">
      <div class="col-sm-12">
        <div class="d-flex align-items-center justify-content-start gap-2">
          <div class="mb-4 ng-select-wrapper flex-grow-1 ">
            <label for="selectedTeam">{{lang.map.select_team}}</label>
            <ng-select [formControl]="selectedTeamControl" [selectOnTab]="true" labelForId="selectedTeam"
                       [clearable]="true"
                       placeholder="{{lang.map.select}}" id="selectedTeam"
                       [notFoundText]="lang.map.msg_not_found">
              <ng-option [disabled]="teamExistsBefore(team)" *ngFor="let team of teams" [value]="team">
                {{team.getName()}}
              </ng-option>
            </ng-select>
          </div>
          <button (click)="addUserTeam()" class="btn btn-primary">add</button>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 mb-3">
        <app-bulk-actions *ngIf="(table.selection?.selected || []).length"
                          [selectedRecords]="(table.selection?.selected || [])"
                          [actionsList]="actions"></app-bulk-actions>
        <app-grid-search style="height: 42px" *ngIf="!(table.selection?.selected || []).length"
                         (searchTextEvent)="filterControl.patchValue($event)"></app-grid-search>
      </div>
      <app-table #table sortableTable [paginator]="paginator"
                 [filter]="filterControl.value"
                 [useSearchToFilter]="true"
                 [selectable]="true"
                 [data]="userTeams"
                 [columns]="displayedColumns">
        <table cdk-table [dataSource]="table.dataSource" class="table table-striped table-bordered caption-top">
          <ng-container cdkColumnDef="checkbox">
            <th cdk-header-cell style="width: 20px;" *cdkHeaderCellDef>
              <input type="checkbox"
                     [indeterminate]="table.selection.hasValue() && !table.allSelected()"
                     (change)="$event ? table.toggleAll() : null"
                     [checked]="table.selection.hasValue() && table.allSelected()"
                     class="form-check-input"></th>
            <td cdk-cell *cdkCellDef="let row">
              <input type="checkbox"
                     (click)="$event.stopPropagation()"
                     [checked]="table.selection.isSelected(row)"
                     (change)="$event ? table.selection.toggle(row) : null"
                     class="form-check-input"></td>
          </ng-container>
          <ng-container cdkColumnDef="arName">
            <th cdk-header-cell sortable-header *cdkHeaderCellDef> {{lang.map.arabic_name}}</th>
            <td cdk-cell *cdkCellDef="let row"> {{row.teamInfo.arName}} </td>
          </ng-container>
          <ng-container cdkColumnDef="enName">
            <th cdk-header-cell sortable-header *cdkHeaderCellDef> {{lang.map.english_name}}</th>
            <td cdk-cell *cdkCellDef="let row"> {{row.teamInfo.enName}} </td>
          </ng-container>
          <ng-container cdkColumnDef="status">
            <th cdk-header-cell *cdkHeaderCellDef> {{lang.map.lbl_status}}</th>
            <td cdk-cell *cdkCellDef="let row">
              <div class="form-check form-switch">
                <input type="checkbox" (change)="toggleTeamUser(row)" [checked]="row.status" class="form-check-input">
              </div>
            </td>
          </ng-container>
          <ng-container cdkColumnDef="actions">
            <th cdk-header-cell *cdkHeaderCellDef> {{lang.map.lbl_actions}}</th>
            <td cdk-cell *cdkCellDef="let row">
              <button (click)="deleteUserTeam(row)" class="btn icon-btn">
                <i class="mdi mdi-delete text-primary"></i>
              </button>
            </td>
          </ng-container>
          <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
          <tr cdk-row *cdkRowDef="let row; columns: displayedColumns;"></tr>
          <tr *cdkNoDataRow>
            <td colspan="20">{{lang.map.no_records_to_display}}</td>
          </tr>
        </table>
      </app-table>
      <app-paginator #paginator></app-paginator>
    </div>
  </ng-template>
</div>
<div class="dialog-actions">
  <button tabindex="-1" *ngIf="validateFieldsVisible" (click)="displayFormValidity(null , content)"
          tooltip="{{lang.map.validate_fields}}" class="btn btn-link">
    <i class="mdi mdi-information-outline text-info"></i>
  </button>
  <div class="flex-grow-1"></div>
  <button (click)="save$.next(null)" class="btn btn-primary">{{lang.map.btn_save}}</button>
  <button [dialogClose]="model" class="btn btn-secondary">{{lang.map.btn_close}}</button>
</div>
