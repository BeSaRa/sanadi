<ng-container *ngIf="showForm">
  <div [formGroup]="form">
    <div class="row">
      <!-- primary Id Type -->
      <div class="col-sm-12 col-md-4 mb-4 ng-select-wrapper">
        <label asteriskIfRequired="primaryIdType" for="primaryIdType"
               class="form-label">{{lang.map.primary_id_type}}</label>
        <ng-select [selectOnTab]="true" labelForId="primaryIdType" [clearable]="false"
                   [readonly]="readonly"
                   placeholder="{{lang.map.select}}" id="primaryIdType"
                   [notFoundText]="lang.map.msg_not_found"
                   formControlName="primaryIdType" validationClasses="primaryIdType">
          <ng-option *ngFor="let option of primaryIdTypeList" [value]="option.lookupKey">
            {{option.getName()}}
          </ng-option>
        </ng-select>
        <app-field-error-message controlName="primaryIdType"></app-field-error-message>
      </div>
      <!-- primaryIdNumber -->
      <div class="col-sm-12 col-md-4 mb-4 position-relative">
        <label asteriskIfRequired="primaryIdNumber" for="primaryIdNumber" class="form-label">{{lang.map.primary_id_number}}</label>
        <input id="primaryIdNumber" validationClasses="primaryIdNumber"
               formControlName="primaryIdNumber" trimInput class="form-control">
        <app-field-error-message controlName="primaryIdNumber"></app-field-error-message>
      </div>
      <!-- arName -->
      <div class="col-sm-12 col-md-4 mb-4 position-relative">
        <label asteriskIfRequired="arName" for="arName" class="form-label">{{lang.map.arabic_name}}</label>
        <input id="arName" validationClasses="arName"
               formControlName="arName" trimInput class="form-control">
        <app-field-error-message controlName="arName"></app-field-error-message>
      </div>
      <!-- age -->
      <div class="col-sm-12 col-md-4 mb-4 position-relative">
        <label asteriskIfRequired="age" for="age" class="form-label">{{lang.map.lbl_age}}</label>
        <input id="age" validationClasses="age"
               type="number"
               [max]="150"
               [mask]="inputMaskPatterns.NUMBER_ONLY"
               formControlName="age" trimInput class="form-control">
        <app-field-error-message controlName="age"></app-field-error-message>
      </div>
      <!-- aidLookupParentId -->
      <div class="col-md-4 col-sm-12 mb-4 ng-select-wrapper">
        <label
          for="aidLookupParentId"
          class="form-label"
          asteriskIfRequired="aidLookupParentId"
        >{{ lang.map.requested_aid_category }}</label
        >
        <ng-select
          [selectOnTab]="true"
          labelForId="aidLookupParentId"
          [clearable]="true"
          placeholder="{{ lang.map.select }}"
          id="aidLookupParentId"
          [notFoundText]="lang.map.msg_not_found"
          appendTo="body"
          (change)="handleMainAidChange($event)"
          formControlName="aidLookupParentId"
          validationClasses="aidLookupParentId"
        >
          <ng-option
            *ngFor="let option of mainAidLookupsList"
            [value]="option.id"
          >
            {{ option.getName() }}
          </ng-option>
        </ng-select>
        <app-field-error-message
          controlName="aidLookupParentId"
        ></app-field-error-message>
      </div>
      <!-- aidLookupId-->
      <div class="col-md-4 col-sm-12 mb-4 ng-select-wrapper">
        <label
          for="aidLookupId"
          class="form-label"
          asteriskIfRequired="aidLookupId"
        >{{ lang.map.requested_aid }}</label
        >
        <ng-select
          [selectOnTab]="true"
          labelForId="aidLookupId"
          [clearable]="false"
          placeholder="{{ lang.map.select }}"
          id="aidLookupId"
          [notFoundText]="lang.map.msg_not_found"
          appendTo="body"
          formControlName="aidLookupId"
          validationClasses="aidLookupId"
        >
          <ng-option
            *ngFor="let option of subAidLookupsList"
            [value]="option.id"
          >
            {{ option.getName() }}
          </ng-option>
        </ng-select>
        <app-field-error-message
          controlName="aidLookupId"
        ></app-field-error-message>
      </div>
      <!-- gender -->
      <div class="col-sm-6 col-md-4 mb-4 position-relative">
        <label asteriskIfRequired="gender" for="gender" labelForId="gender" class="form-label">{{ lang.map.gender
          }}</label>
        <ng-select [selectOnTab]="true" [clearable]="true" placeholder="{{ lang.map.select }}"
                   [notFoundText]="lang.map.msg_not_found" appendTo="body"
                   id="gender"
                   formControlName="gender" validationClasses="gender">
          <ng-option *ngFor="let option of GenderList" [value]="option.lookupKey">{{ option.getName() }}</ng-option>
        </ng-select>
        <app-field-error-message controlName="gender"></app-field-error-message>
      </div>
      <!-- relativeType -->
      <div class="col-sm-6 col-md-4 mb-4 position-relative">
        <label asteriskIfRequired="relativeType" for="relativeType" labelForId="relativeType" class="form-label">{{ lang.map.relative_type
          }}</label>
        <ng-select [selectOnTab]="true" [clearable]="true" placeholder="{{ lang.map.select }}"
                   [notFoundText]="lang.map.msg_not_found" appendTo="body"
                   id="relativeType"
                   formControlName="relativeType" validationClasses="relativeType">0
          <ng-option *ngFor="let option of benRequestorRelationType" [value]="option.lookupKey">{{ option.getName() }}</ng-option>
        </ng-select>
        <app-field-error-message controlName="relativeType"></app-field-error-message>
      </div>

      <!-- occuption -->
      <div
        class="col-md-4 col-sm-12 mb-4 position-relative"
      >
        <label
          for="occuption"
          class="form-label"
          asteriskIfRequired="occuption"
        >{{ lang.map.occupation }}</label
        >
        <input
          id="occuption"
          validationClasses="occuption"
          formControlName="occuption"
          maxlength="100"
          trimInput
          class="form-control"
          type="text"
        />
        <app-field-error-message
          controlName="occuption"
        ></app-field-error-message>
      </div>


    </div>
    <div class="d-flex flex-row align-items-center justify-content-center">
      <button (click)="save()" [disabled]="readonly" *ngIf="!readonly && !viewOnly"
              class="btn btn-primary m-2">{{ !!editItem ? lang.map.btn_save : lang.map.btn_add }}
      </button>
      <button (click)="cancelForm()"
              class="btn btn-secondary m-2">{{ lang.map.btn_cancel }}
      </button>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="!showForm">
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <app-table #table sortableTable [paginator]="paginator" [data]="list"
                   [columns]="columns"
                   [filter]="filterControl.value" [useSearchToFilter]="true">
          <table class="table table-striped table-bordered caption-top" cdk-table [dataSource]="table.dataSource">
            <ng-container cdkColumnDef="extra-header">
              <th class="extra-header" cdk-header-cell colSpan="100" *cdkHeaderCellDef>
                <table-header tableTitle="beneficiary_family"
                              [sort]="table.dataSource.sort"
                              (textChange)="filterControl.setValue($event)"
                              [add$]="add$" [allowAdd]="!readonly && !showForm">
                </table-header>
              </th>
            </ng-container>

            <ng-container cdkColumnDef="primaryIdType">
              <th cdk-header-cell *cdkHeaderCellDef sortable-header [sortParamAsFullItem]="true">
                {{lang.map.primary_id_type}}</th>
              <td cdk-cell *cdkCellDef="let row"> {{row.primaryIdTypeInfo?.getName()}} </td>
            </ng-container>
            <ng-container cdkColumnDef="primaryIdNumber">
              <th cdk-header-cell *cdkHeaderCellDef sortable-header [sortParamAsFullItem]="true">
                {{lang.map.primary_id_number}}</th>
              <td cdk-cell *cdkCellDef="let row"> {{row.primaryIdNumber}} </td>
            </ng-container>
            <ng-container cdkColumnDef="arName">
              <th cdk-header-cell *cdkHeaderCellDef sortable-header [sortParamAsFullItem]="true">
                {{lang.map.arabic_name}}</th>
              <td cdk-cell *cdkCellDef="let row"> {{row.arName}} </td>
            </ng-container>
            <ng-container cdkColumnDef="relativeType">
              <th cdk-header-cell *cdkHeaderCellDef sortable-header [sortParamAsFullItem]="true">
                {{lang.map.relative_type}}</th>
              <td cdk-cell *cdkCellDef="let row"> {{row.relativeTypeInfo?.getName()}} </td>
            </ng-container>
            <ng-container cdkColumnDef="occuption">
              <th cdk-header-cell *cdkHeaderCellDef sortable-header [sortParamAsFullItem]="true">
                {{lang.map.occupation}}</th>
              <td cdk-cell *cdkCellDef="let row"> {{row.occuption}} </td>
            </ng-container>

            <ng-container cdkColumnDef="actions">
              <th cdk-header-cell *cdkHeaderCellDef> {{ lang.map.lbl_actions }}</th>
              <td cdk-cell *cdkCellDef="let row; let i = index;" class="table-actions">
                <grid-actions [record]="row" [actions]="actions" [itemIndex]="i"
                              [rebindTrigger]="readonly"></grid-actions>
              </td>
            </ng-container>

            <tr cdk-header-row *cdkHeaderRowDef="headerColumn"></tr>
            <tr cdk-header-row class="table-row-header" *cdkHeaderRowDef="table.columns"></tr>
            <tr cdk-row *cdkRowDef="let row; columns: table.columns;"
                (contextmenu)="menu.open($event , row)"></tr>
            <tr *cdkNoDataRow>
              <td class="text-center" colSpan="100">{{ lang.map.msg_no_records_found }}</td>
            </tr>
          </table>
          <app-paginator #paginator></app-paginator>
        </app-table>
        <context-menu-item #menu [actions]="actions"></context-menu-item>
      </div>
    </div>
  </div>
</ng-container>


