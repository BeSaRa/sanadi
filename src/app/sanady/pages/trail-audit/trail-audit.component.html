<form [formGroup]="form" autocomplete="off">
  <h4 class="text-primary">{{ langService.map.search_criteria }}</h4>
  <div class="row">
    <div class="col-sm-12 col-md-6">
      <div class="row">
        <label for="actionDateFrom" class="col-sm-12 col-md-4 col-form-label"
               asteriskIfRequired="actionDateFrom">{{ langService.map.action_date_from }}</label>
        <div class="col-md-8 col-sm-12 mb-4 position-relative">
          <div class="input-group">
            <i class="input-group-text mdi mdi-calendar"></i>
            <div class="form-control" formControlName="actionDateFrom"
                 id="actionDateFrom" [options]="datepickerOptionsMap.actionDateFrom"
                 (click)="dpFromDate.toggleCalendar()" #dpFromDate="angular-mydatepicker"
                 angular-mydatepicker validationClasses="actionDateFrom"
                 (inputFieldChanged)="onDateChange($event, 'actionDateFrom', 'acionDateTo')"></div>
            <app-field-error-message controlName="actionDateFrom"></app-field-error-message>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-6">
      <div class="row">
        <label for="acionDateTo" class="col-sm-12 col-md-4 col-form-label"
               asteriskIfRequired="acionDateTo">{{ langService.map.action_date_to }}</label>
        <div class="col-md-8 col-sm-12 mb-4 position-relative">
          <div class="input-group">
            <i class="input-group-text mdi mdi-calendar"></i>
            <div class="form-control" formControlName="acionDateTo"
                 id="acionDateTo" [options]="datepickerOptionsMap.acionDateTo"
                 (click)="dpToDate.toggleCalendar()" #dpToDate="angular-mydatepicker"
                 angular-mydatepicker validationClasses="acionDateTo"
                 (inputFieldChanged)="onDateChange($event, 'actionDateFrom', 'acionDateTo')"></div>
            <app-field-error-message controlName="acionDateTo"></app-field-error-message>
          </div>
        </div>
      </div>
    </div>
  </div>
  @if (isBeneficiaryReport) {
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="qId" class="col-sm-12 col-md-4 col-form-label"
                 asteriskIfRequired="qId">{{ langService.map.identification_number }}</label>
          <div class="col-md-8 col-sm-12 mb-4 ng-select-wrapper">
            <input class="form-control" formControlName="qId"
                   id="qId" validationClasses="qId">
            <app-field-error-message controlName="qId"></app-field-error-message>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="gdxServiceId" class="col-sm-12 col-md-4 col-form-label"
                 asteriskIfRequired="gdxServiceId">{{ langService.map.the_party_being_inquired_about }}</label>
          <div class="col-md-8 col-sm-12 mb-4 ng-select-wrapper">
            <ng-select [selectOnTab]="true" labelForId="gdxServiceId" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="gdxServiceId"
                       [notFoundText]="langService.map.msg_not_found"
                       (change)="loadUsersByOrgUnit()" appendTo="body"
                       validationClasses="gdxServiceId" formControlName="gdxServiceId">
              <ng-option *ngFor="let option of GdxServicesList" [value]="option.lookupKey">
                {{ option.getName() }}
              </ng-option>
            </ng-select>
            <app-field-error-message controlName="gdxServiceId"></app-field-error-message>
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="profileId" class="col-sm-12 col-md-4 col-form-label"
                 asteriskIfRequired="profileId">{{ langService.map.lbl_organization }}</label>
          <div class="col-md-8 col-sm-12 mb-4 ng-select-wrapper">
            <ng-select [selectOnTab]="true" labelForId="profileId" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="profileId"
                       [notFoundText]="langService.map.msg_not_found"
                       (change)="loadUsersByOrgUnit()" appendTo="body"
                       validationClasses="profileId" formControlName="profileId">
              <ng-option *ngFor="let option of profilesList" [value]="option.id">
                {{ option.getName() }}
              </ng-option>
            </ng-select>
            <app-field-error-message controlName="profileId"></app-field-error-message>
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="orgUserId" class="col-sm-12 col-md-4 col-form-label"
                 asteriskIfRequired="orgUserId">{{ langService.map.user }}</label>
          <div class="col-md-8 col-sm-12 mb-4 ng-select-wrapper">
            <ng-select [selectOnTab]="true" labelForId="orgUserId" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="orgUserId"
                       [notFoundText]="langService.map.msg_not_found"
                       validationClasses="orgUserId"
                       formControlName="orgUserId" appendTo="body">
              <ng-option value="">{{ langService.map.lbl_none }}</ng-option>
              <ng-option *ngFor="let option of orgUsersList" [value]="option.id">
                {{ option.getName() }}
              </ng-option>
            </ng-select>
            <app-field-error-message controlName="orgUserId"></app-field-error-message>
          </div>
        </div>
      </div>
    </div>
  }
  <div class="d-flex justify-content-center py-3">
    <button (click)="$search.next()" [disabled]="form.invalid"
            class="btn btn-primary mx-2">{{ langService.map.lbl_search }}
    </button>
  </div>
</form>
<div class="row">
  <div class="col-12">
    <div class="table-responsive">
      <app-table #table sortableTable [paginator]="paginator" [data]="models" [columns]="displayedColumns"
                 [filter]="filterControl.value" [useSearchToFilter]="true">
        <table class="table table-striped table-bordered caption-top" cdk-table [dataSource]="table.dataSource">
          <ng-container cdkColumnDef="extra-header">
            <th class="extra-header" cdk-header-cell colSpan="100" *cdkHeaderCellDef>
              <table-header [tableTitle]="title"
                            [sort]="table.dataSource.sort"
                            (textChange)="filterControl.setValue($event)"></table-header>
            </th>
          </ng-container>
          <ng-container cdkColumnDef="requestFullSerial">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.serial_number }}</th>
            <td cdk-cell *cdkCellDef="let row">
              {{ row.requestFullSerial }}
            </td>
          </ng-container>
          <ng-container cdkColumnDef="qId">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.lbl_qid }}</th>
            <td cdk-cell *cdkCellDef="let row">
              {{ row.qId }}
            </td>
          </ng-container>
          <ng-container cdkColumnDef="name">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.name }}</th>
            <td cdk-cell *cdkCellDef="let row">
              {{ row.getName() }}
            </td>
          </ng-container>
          <ng-container cdkColumnDef="gdxServiceId">
            <th cdk-header-cell *cdkHeaderCellDef> {{ isBeneficiaryReport ? langService.map.gdx_service : langService.map.gdx_inquire_service }}</th>
            <td cdk-cell *cdkCellDef="let row">
              {{ row.gdxServiceInfo?.getName() }}
            </td>
          </ng-container>
          <ng-container cdkColumnDef="actionTime">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.action_time }}</th>
            <td cdk-cell *cdkCellDef="let row">
              <pre>{{ row.actionTime | date: 'YYYY/MMM/d' }} - {{ row.actionTime | date: 'HH:mm'}}</pre>
            </td>
          </ng-container>
          <ng-container cdkColumnDef="profileId">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.lbl_profile }}</th>
            <td cdk-cell *cdkCellDef="let row">
              {{ row.profileInfo?.getName() }}
            </td>
          </ng-container>
          <ng-container cdkColumnDef="benNationality">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.lbl_nationality }}</th>
            <td cdk-cell *cdkCellDef="let row">
              {{ row.benNationalityInfo?.getName() }}
            </td>
          </ng-container>

          <ng-container cdkColumnDef="actions">
            <th cdk-header-cell *cdkHeaderCellDef> {{ langService.map.lbl_actions }}</th>
            <td cdk-cell *cdkCellDef="let row" class="table-actions">
              <grid-actions [record]="row" [actions]="actions"></grid-actions>
            </td>
          </ng-container>
          <tr cdk-header-row *cdkHeaderRowDef="headerColumn"></tr>
          <tr cdk-header-row class="table-row-header" *cdkHeaderRowDef="table.columns"></tr>
          <tr cdk-row *cdkRowDef="let row; columns: table.columns;" (contextmenu)="menu.open($event , row)"></tr>
          <tr *cdkNoDataRow>
            <td colspan="100" class="text-center">{{ langService.map.no_records_to_display }}</td>
          </tr>
        </table>
        <app-paginator #paginator [length]="(models.length || 0)"></app-paginator>
      </app-table>
      <context-menu-item #menu [actions]="actions"></context-menu-item>
    </div>
  </div>
</div>
