<div class="container shadow-sm h-100 bg-white p-4">
  <div class="row">
    <div class="col-12 d-flex align-items-center">
      <h1 class="h6 text-primary m-0 d-inline-block">{{langService.map.menu_request_search}}</h1>
    </div>
  </div>

  <form autocomplete="off" [formGroup]="form">
    <div class="row mt-3">
      <tabs-list [tabByIndex$]="tabIndex$">
        <tab [template]="searchCriteria" [title]="langService.map.search_criteria"></tab>
        <tab [disabled]="!requests.length" [template]="searchResult" [title]="langService.map.search_result"></tab>
      </tabs-list>
    </div>
    <ng-template #searchCriteria>
      <div formGroupName="simpleSearch" id="simple-search">
        <div class="row">
          <div formGroupName="request" class="col-sm-12 col-md-6">
            <div class="row">
              <label for="requestSerial"
                     class="col-sm-12 col-md-4 col-form-label">{{langService.map.serial_number}}</label>
              <div class="col-md-8 col-sm-12 mb-4">
                <input formControlName="requestSerial" id="requestSerial" type="text" class="form-control">
              </div>
            </div>
          </div>
          <div class="col-sm-12 col-md-6">
            <div class="row">
              <label for="year" class="col-sm-12 col-md-4 col-form-label">{{langService.map.year}}</label>
              <div class="col-md-8 col-sm-12 mb-4">
                <select formControlName="year" class="form-select" id="year">
                  <option [ngValue]="year" *ngFor="let year of years">{{year}}</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div formGroupName="beneficiary">
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="idType" class="col-sm-12 col-md-4 col-form-label">{{langService.map.id_type}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select formControlName="benPrimaryIdType" class="form-select"
                          id="idType">
                    <option [ngValue]="option.lookupKey" *ngFor="let option of idTypes">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="idNumber" class="col-sm-12 col-md-4 col-form-label">{{langService.map.id_number}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input id="idNumber" formControlName="benPrimaryIdNumber" type="text" class="form-control">
                </div>
              </div>
            </div>
          </div>
          <div formGroupName="arName" class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="arMethod"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.search_method}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select formControlName="operator" class="form-select" id="arMethod">
                    <option [ngValue]="stringOperationMap[option.lookupKey]"
                            *ngFor="let option of stringOperators">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="arName" class="col-sm-12 col-md-4 col-form-label">{{langService.map.arabic_name}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input formControlName="value" id="arName" type="text" class="form-control">
                </div>
              </div>
            </div>
          </div>
          <div formGroupName="enName" class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="enMethod"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.search_method}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select formControlName="operator" class="form-select" id="enMethod">
                    <option [ngValue]="stringOperationMap[option.lookupKey]"
                            *ngFor="let option of stringOperators">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="enName" class="col-sm-12 col-md-4 col-form-label">{{langService.map.english_name}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input id="enName" formControlName="value" type="text" class="form-control">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 d-flex flex-row align-items-center justify-content-center">
            <button (click)="onClickSimpleSearch()" class="btn btn-primary mx-2">{{langService.map.lbl_search}}</button>
            <button class="btn btn-secondary mx-2">{{langService.map.btn_clear}}</button>
          </div>
        </div>
      </div> <!-- simple search-->
      <hr/>
      <div formGroupName="advancedSearch" id="advanced-search">
        <div formGroupName="beneficiary">
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="nationality"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.lbl_nationality}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select formControlName="benNationality" class="form-select" id="nationality">
                    <option [ngValue]="option.lookupKey"
                            *ngFor="let option of nationalities">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="employmentStatus"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.employment_status}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select class="form-select" id="employmentStatus">
                    <option [ngValue]="option.lookupKey"
                            *ngFor="let option of employmentStatus">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="phoneNumber1"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.mobile_number}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input formControlName="phoneNumber1" class="form-control" type="text" id="phoneNumber1">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div formGroupName="request">
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="status"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.request_status}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select formControlName="status" class="form-select" id="status">
                    <option [ngValue]="option.lookupKey"
                            *ngFor="let option of requestsStatus">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="requestType"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.reason_of_request}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <select formControlName="requestType" class="form-select" id="requestType">
                    <option [ngValue]="option.lookupKey"
                            *ngFor="let option of requestTypes">{{option.getName()}}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="creationDateFrom"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.creation_date_from}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input type="date" formControlName="creationDateFrom" class="form-control" id="creationDateFrom">
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="creationDateTo"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.creation_date_to}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input type="date" formControlName="creationDateTo" class="form-control" id="creationDateTo">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="statusDateFrom"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.status_date_from}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input type="date" formControlName="statusDateModifiedFrom" class="form-control" id="statusDateFrom">
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="row">
                <label for="statusDateTo"
                       class="col-sm-12 col-md-4 col-form-label">{{langService.map.status_date_to}}</label>
                <div class="col-md-8 col-sm-12 mb-4">
                  <input type="date" formControlName="statusDateModifiedTo" class="form-control" id="statusDateTo">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 d-flex flex-row align-items-center justify-content-center ">
            <button (click)="onClickAdvancedSearch()"
                    class="btn btn-primary mx-2">{{langService.map.lbl_search}}</button>
            <button class="btn btn-secondary mx-2">{{langService.map.btn_clear}}</button>
          </div>
        </div>
      </div><!-- advanced search -->
    </ng-template>
  </form>
  <ng-template #searchResult>
    <div *ngIf="requests.length">
      <div class="row">
        <div class="col-12 d-flex align-items-center justify-content-end">
          <button class="btn btn-link outline-none"
                  tooltip="{{langService.map.print}}"
                  (click)="printResult($event)">
            <i class="mdi mdi-printer"></i></button>
        </div>
      </div>
      <div class="row">
        <table class="table table-striped table-bordered caption-top">
          <thead role="rowgroup">
          <tr>
            <th>{{langService.map.request_number}}</th>
            <th>{{langService.map.request_date}}</th>
            <th>{{langService.map.lbl_org_unit}}</th>
            <th>{{langService.map.aid_status}}</th>
            <th>{{langService.map.request_aid_amount}}</th>
            <th>{{langService.map.aid_type}}</th>
            <th>{{langService.map.approved_aid_amount}}</th>
            <th>{{langService.map.lbl_actions}}</th>
          </tr>
          </thead>
          <tbody>
          <ng-container *ngFor="let request of requests;">
            <div *ngIf="request.aids && request.aids.length > 0; then multiAidRow else noAidRow"></div>
            <ng-template #multiAidRow>
              <tr *ngFor="let aid of request.aids; let firstAid = first;">
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"><span
                  class="dir-ltr d-inline-block"> {{request.requestFullSerial}} </span></td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"> {{request.creationDate|date}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"> {{request.orgBranchInfo.getName()}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"> {{request.statusInfo.getName()}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"> {{request.requestedAidAmount}} </td>
                <td> {{aid.aidLookupInfo.getName()}} </td>
                <td> {{aid.aidAmount}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length">
                  <div class="d-flex flex-row">
                    <a href="#" (click)="printRequest($event, request)" tooltip="{{langService.map.print_request_form}}" class="icon-btn">
                      <i class="mdi mdi-printer"></i>
                    </a>
                    <a href="#" (click)="request.showLog($event)" tooltip="{{langService.map.show_logs}}" class="icon-btn">
                      <i class="mdi mdi-history"></i>
                    </a>
                    <a href="#" (click)="request.showAid($event)" tooltip="{{langService.map.show_aids}}" class="icon-btn">
                      <i class="mdi mdi-heart-multiple"></i>
                    </a>
                    <a (click)="editRequest(request)" tooltip="{{langService.map.btn_edit}}"
                       class="icon-btn">
                      <i class="mdi mdi-book-edit"></i>
                    </a>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template #noAidRow>
              <tr>
                <td><span class="dir-ltr d-inline-block"> {{request.requestFullSerial}} </span></td>
                <td> {{request.creationDate|date}} </td>
                <td> {{request.orgBranchInfo.getName()}} </td>
                <td> {{request.statusInfo.getName()}} </td>
                <td> {{request.requestedAidAmount}} </td>
                <td></td>
                <td></td>
                <td>
                  <div class="d-flex flex-row">
                    <a href="#" (click)="printRequest($event, request)" tooltip="{{langService.map.print_request_form}}" class="icon-btn">
                      <i class="mdi mdi-printer"></i>
                    </a>
                    <a href="#" (click)="request.showLog($event)" tooltip="{{langService.map.show_logs}}" class="icon-btn">
                      <i class="mdi mdi-history"></i>
                    </a>
                    <a href="#" (click)="request.showAid($event)" tooltip="{{langService.map.show_aids}}" class="icon-btn">
                      <i class="mdi mdi-heart-multiple"></i>
                    </a>
                    <a (click)="editRequest(request)" tooltip="{{langService.map.btn_edit}}"
                       class="icon-btn">
                      <i class="mdi mdi-book-edit"></i>
                    </a>
                  </div>
                </td>
              </tr>
            </ng-template>
          </ng-container>
          </tbody>
        </table>
      </div>
    </div>

  </ng-template>
</div>
