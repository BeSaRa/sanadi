<div class="row">
  <div class="col-12 d-flex align-items-center">
    <h1 class="h6 text-primary m-0 d-inline-block">{{langService.map.menu_partial_request_reports}}</h1>
  </div>
</div>
<form autocomplete="off" [formGroup]="form">
  <div class="row mt-3">
    <tabs-list [tabByIndex$]="tabIndex$">
      <tab [template]="searchCriteria" [title]="langService.map.search_criteria"></tab>
      <tab [disabled]="!logRecords.length" [template]="searchResult" [title]="getResultTabTitle"></tab>
    </tabs-list>
  </div>
  <ng-template #searchCriteria>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="orgId" class="col-sm-12 col-md-4 col-form-label">{{langService.map.lbl_organization}}</label>
          <div class="col-md-8 col-sm-12 mb-4 position-relative">
            <ng-select [selectOnTab]="true" labelForId="orgId" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="orgId"
                       [notFoundText]="langService.map.msg_not_found"
                       (change)="loadUsersByOrgUnit($event)"
                       formControlName="orgId">
              <ng-option value="">{{langService.map.lbl_none}}</ng-option>
              <ng-option *ngFor="let option of orgUnitsList" [value]="option.id">
                {{option.getName()}}
              </ng-option>
            </ng-select>
            <app-field-error-message
              [control]="fm.getFormField('orgId')"></app-field-error-message>
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="orgUserId" class="col-sm-12 col-md-4 col-form-label">{{langService.map.user}}</label>
          <div class="col-md-8 col-sm-12 mb-4 ng-select-wrapper">
            <ng-select [selectOnTab]="true" labelForId="orgUserId" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="orgUserId"
                       [notFoundText]="langService.map.msg_not_found"
                       formControlName="orgUserId">
              <ng-option value="">{{langService.map.lbl_none}}</ng-option>
              <ng-option *ngFor="let option of orgUsersList" [value]="option.id">
                {{option.getName()}}
              </ng-option>
            </ng-select>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="fromDate" class="col-sm-12 col-md-4 col-form-label"
                 asteriskIfRequired="fromDate">{{langService.map.action_date_from}}</label>
          <div class="col-md-8 col-sm-12 mb-4 position-relative">
            <div class="input-group">
              <i class="input-group-text mdi mdi-calendar"></i>
              <input class="form-control" angular-mydatepicker #dpFromDate="angular-mydatepicker"
                     name="fromDate" formControlName="fromDate" id="fromDate" dateFix
                     [options]="datepickerOptionsMap.fromDate" autocomplete="off"
                     (inputFieldChanged)="onDateChange($event, 'fromDate', 'toDate')"
                     (click)="dpFromDate.toggleCalendar()">
              <app-field-error-message
                [control]="fm.getFormField('fromDate')"></app-field-error-message>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-md-6">
        <div class="row">
          <label for="toDate" class="col-sm-12 col-md-4 col-form-label"
                 asteriskIfRequired="toDate">{{langService.map.action_date_to}}</label>
          <div class="col-md-8 col-sm-12 mb-4 position-relative">
            <div class="input-group">
              <i class="input-group-text mdi mdi-calendar"></i>
              <input class="form-control" angular-mydatepicker #dpToDate="angular-mydatepicker"
                     name="toDate" formControlName="toDate" id="toDate" dateFix
                     [options]="datepickerOptionsMap.toDate" autocomplete="off"
                     (inputFieldChanged)="onDateChange($event, 'fromDate', 'toDate')"
                     (click)="dpToDate.toggleCalendar()">
              <app-field-error-message
                [control]="fm.getFormField('toDate')"></app-field-error-message>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr/>
    <div class="row">
      <div class="col-12 d-flex flex-row align-items-center justify-content-center ">
        <button (click)="onSearch()" [disabled]="form.invalid"
                class="btn btn-primary mx-2">{{langService.map.lbl_search}}</button>
        <button (click)="clearSearch()"
                class="btn btn-secondary mx-2">{{langService.map.btn_clear}}</button>
      </div>
    </div>
  </ng-template>
</form>
<ng-template #searchResult>
  <div *ngIf="logRecords.length">
    <div class="row">
      <div class="col-6 d-flex align-items-center justify-content-start">
        <button class="btn btn-link outline-none"
                tooltip="{{langService.map.btn_reload}}"
                (click)="reloadSearchResults()">
          <i class="mdi mdi-reload"></i></button>
      </div>
      <div class="col-6 d-flex align-items-center justify-content-end">
        <button class="btn btn-link outline-none"
                tooltip="{{langService.map.print}}"
                (click)="printResult($event)">
          <i class="mdi mdi-printer"></i></button>
      </div>
    </div>
    <div class="row">
      <div class="table-responsive">
        <table class="table table-striped table-bordered caption-top">
          <thead role="rowgroup">
          <tr>
            <th>{{langService.map.request_number}}</th>
            <th class="date-column">{{langService.map.request_date}}</th>
            <th>{{langService.map.beneficiary_category}}</th>
            <th>{{langService.map.reason_of_request}}</th>
            <th>{{langService.map.request_summary}}</th>
            <th>{{langService.map.action_type}}</th>
            <th class="date-column">{{langService.map.action_date}}</th>
            <th>{{langService.map.user_organization}}</th>
            <th>{{langService.map.user}}</th>
          </tr>
          </thead>
          <tbody>
          <ng-container *ngFor="let record of logRecords;">
            <tr>
              <td>
                <a href="#" (click)="$event.preventDefault()"
                   class="dir-ltr d-inline-block text-decoration-none"> {{record.requestFullSerial}} </a>
              </td>
              <td class="date-column">{{record.creationDateString}}</td>
              <td>{{record.benCategoryInfo.getName()}}</td>
              <td>{{record.requestTypeInfo.getName()}}</td>
              <td>{{record.requestSummary}}</td>
              <td>{{record.actionTypeInfo.getName()}}</td>
              <td class="date-column">{{record.actionDateString}}</td>
              <td>{{record.orgAndBranchInfo?.getName()}}</td>
              <td>{{record.orgUserInfo.getName()}}</td>
            </tr>
          </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</ng-template>
