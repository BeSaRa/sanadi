<fieldset class="mb-4">
  <legend><span class="h6 text-primary">{{langService.map.menu_inquiries}}</span></legend>
  <form [formGroup]="form" *ngIf="isNormalBenSearch" autocomplete="off" action="#">
    <!-- Inquiry Types -->
    <div class="row">
      <div class="col mb-4">
        <div class="form-check form-check-inline" *ngIf="searchByNamePermission">
          <input formControlName="inquiryType" [value]="false" class="form-check-input" type="radio"
                 name="inquiryType" id="inquiryByName">
          <label class="form-check-label" for="inquiryByName">
            {{langService.map.inquiry_by_name}}
          </label>
        </div>
        <div class="form-check form-check-inline">
          <input formControlName="inquiryType" [value]="true" class="form-check-input" type="radio"
                 name="inquiryType" id="inquiryById">
          <label class="form-check-label" for="inquiryById">
            {{langService.map.inquiry_by_id}}
          </label>
        </div>
      </div>
    </div>
    <!-- Search By Name -->
    <div formGroupName="searchByName" *ngIf="!displayIdCriteria && searchByNamePermission" class="row">
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="searchMethod">{{langService.map.search_method}}</label>
          <ng-select [selectOnTab]="true" labelForId="searchMethod" [clearable]="false"
                     placeholder="{{langService.map.select}}" id="searchMethod"
                     [notFoundText]="langService.map.msg_not_found"
                     formControlName="operator">
            <ng-option *ngFor="let option of stringOperators" [value]="option.lookupKey">
              {{option.getName()}}
            </ng-option>
          </ng-select>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4">
          <label for="arName">{{langService.map.arabic_name}}</label>
          <input type="text" formControlName="arName" id="arName" class="form-control">
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4">
          <label for="enName">{{langService.map.english_name}}</label>
          <input type="text" formControlName="enName" id="enName" class="form-control" name="enName">
        </div>
      </div>
    </div>
    <!-- Search By Id -->
    <div formGroupName="searchById" *ngIf="displayIdCriteria" class="row flex-sm-column flex-md-row">
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="identification" class="form-label"
                 asteriskIfRequired="identification">{{langService.map.identification}}</label>
          <ng-select [selectOnTab]="true" labelForId="identification" [clearable]="false"
                     placeholder="{{langService.map.select}}" id="identification"
                     [notFoundText]="langService.map.msg_not_found"
                     formControlName="identification">
            <ng-option *ngFor="let option of identifications" [value]="option.lookupKey">
              {{option.getName()}}
            </ng-option>
          </ng-select>
          <app-field-error-message
            [control]="fm.getFormField('searchById.identification')"></app-field-error-message>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="idType" class="form-label" asteriskIfRequired="idType">{{langService.map.id_type}}</label>
          <ng-select [selectOnTab]="true" labelForId="idType" [clearable]="false"
                     placeholder="{{langService.map.select}}" id="idType"
                     [notFoundText]="langService.map.msg_not_found"
                     formControlName="idType">
            <ng-option *ngFor="let option of idTypes" [value]="option.lookupKey">
              {{option.getName()}}
            </ng-option>
          </ng-select>
          <app-field-error-message
            [control]="fm.getFormField('searchById.idType')"></app-field-error-message>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 position-relative">
          <label for="text" class="form-label" asteriskIfRequired="idNumber">{{langService.map.id_number}}</label>
          <input [ngClass]="fm.getInvalidClass('searchById.idNumber')" type="text"
                 formControlName="idNumber" id="text" class="form-control"
                 name="idNumber" maxlength="20">
          <app-field-error-message
            [control]="fm.getFormField('searchById.idNumber')"></app-field-error-message>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper" *ngIf="nationalityVisible">
          <ng-container *ngIf="nationalityListType === 'normal'">
            <label for="nationality" class="form-label"
                   asteriskIfRequired="nationality">{{langService.map.lbl_nationality}}</label>
            <ng-select [selectOnTab]="true" labelForId="nationality" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="nationality"
                       [notFoundText]="langService.map.msg_not_found"
                       formControlName="nationality"
                       [ngClass]="fm.getStatusClass('searchById.nationality')">
              <ng-option value="">{{langService.map.lbl_none}}</ng-option>
              <ng-option *ngFor="let option of nationalities" [value]="option.lookupKey">
                {{option.getName()}}
              </ng-option>
            </ng-select>
          </ng-container>
          <ng-container *ngIf="nationalityListType === 'gulf'">
            <label for="nationalityGulf" class="form-label"
                   asteriskIfRequired="nationality">{{langService.map.country}}</label>
            <ng-select [selectOnTab]="true" labelForId="nationalityGulf" [clearable]="false"
                       placeholder="{{langService.map.select}}" id="nationalityGulf"
                       [notFoundText]="langService.map.msg_not_found"
                       formControlName="nationality"
                       [ngClass]="fm.getStatusClass('searchById.nationality')">
              <ng-option value="">{{langService.map.lbl_none}}</ng-option>
              <ng-option *ngFor="let option of gulfCountries" [value]="option.lookupKey">
                {{option.getName()}}
              </ng-option>
            </ng-select>
          </ng-container>
          <app-field-error-message
            [control]="fm.getFormField('searchById.nationality')"></app-field-error-message>
        </div>
      </div>
    </div>
    <!-- Form Button -->
    <div class="row">
      <div class="col d-flex flex-row justify-content-start">
        <button (click)="search()" [disabled]="currentForm?.invalid"
                class="btn shadow-sm btn-primary">{{langService.map.lbl_search}}</button>
        <button (click)="resetCurrentForm()"
                class="btn shadow-sm btn-secondary mx-3">{{langService.map.btn_clear}}</button>
      </div>
    </div>
  </form>

  <div [formGroup]="form" *ngIf="isBenSearchFromRequest">
    <div formGroupName="searchById" class="row flex-sm-column flex-md-row">
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="identification" class="form-label"
                 asteriskIfRequired="identification">{{langService.map.identification}}</label>
          <span
            class="form-control input-disabled">{{identificationsLookup[identificationField?.value].getName() || '&nbsp;'}}</span>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="idType" class="form-label" asteriskIfRequired="idType">{{langService.map.id_type}}</label>
          <span class="form-control input-disabled">{{idTypesLookup[idTypeField?.value].getName() || 'nbsp;'}}</span>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 position-relative">
          <label for="text" class="form-label" asteriskIfRequired="idNumber">{{langService.map.id_number}}</label>
          <span class="form-control input-disabled">{{idNumberField?.value || '&nbsp;'}}</span>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper" *ngIf="nationalityVisible">
          <ng-container *ngIf="nationalityListType === 'normal'">
            <label for="nationality" class="form-label"
                   asteriskIfRequired="nationality">{{langService.map.lbl_nationality}}</label>
            <span
              class="form-control input-disabled">{{nationalitiesLookup[nationalityField?.value].getName() || '&nbsp;'}}</span>
          </ng-container>
          <ng-container *ngIf="nationalityListType === 'gulf'">
            <label for="nationalityGulf" class="form-label"
                   asteriskIfRequired="nationality">{{langService.map.country}}</label>
            <span
              class="form-control input-disabled">{{gulfCountriesLookup[nationalityField?.value].getName() || '&nbsp;'}}</span>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</fieldset>

<div *ngIf="!!beneficiary" class="row">
  <div class="col-12">
    <div><h1 class="h6 text-primary">{{langService.map.personal_info}}</h1></div>
    <div class="table-responsive column-style">
      <table class="table table-bordered caption-top">
        <tbody>
        <tr>
          <th>{{langService.map.arabic_name}}</th>
          <td>{{beneficiary?.arName}}</td>
          <th>{{langService.map.employer}}</th>
          <td>{{beneficiary?.employeer}}</td>
        </tr>
        <tr>
          <th>{{langService.map.lbl_nationality}}</th>
          <td>{{beneficiary?.benNationalityInfo?.getName()}}</td>
          <th>{{langService.map.id_type}}</th>
          <td>{{beneficiary?.benPrimaryIdTypeInfo?.getName()}}</td>
        </tr>
        <tr>
          <th>{{langService.map.gender}}</th>
          <td>{{beneficiary?.genderInfo?.getName()}}</td>
          <th>{{langService.map.date_of_birth}}</th>
          <td>{{beneficiary?.dateOfBirthString|date}}</td>
        </tr>
        <tr>
          <th>{{langService.map.sponsors_count}}</th>
          <td class="position-relative">
            <div class="d-flex align-items-center flex-row h-100 w-100">
              <span>{{beneficiary?.benDependentsCount}}</span><span class="flex-grow-1"></span>
              <button disabled class="btn btn-sm btn-primary shadow-sm">{{langService.map.show_details}}</button>
            </div>
          </td>
        </tr>
        </tbody>
      </table><!-- table -->
    </div><!-- table container-->
  </div>
</div><!-- -->
<!--  we hide this part cause there is no integration with MOI yet -->
<div *ngIf="false" class="row">
  <div class="col-12">
    <div><h6>{{langService.map.family_info}}</h6></div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered caption-top">
        <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Relation</th>
          <th scope="col">ID Number</th>
          <th scope="col">ID type</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        </tbody>
      </table><!-- table -->
    </div><!-- table container-->
  </div>
</div>
<div *ngIf="requests.length" class="row">
  <div class="col">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="personal-aid-tab" data-bs-toggle="tab" href="#personal-aid" role="tab"
           aria-controls="personal-aids" aria-selected="true">{{langService.map.personal_aid}}</a>
      </li>
    </ul>
    <div class="tab-content py-3">
      <div class="tab-pane fade show active" id="personal-aid" role="tabpanel" aria-labelledby="personal-aid-tab">
        <div class="row">
          <div class="col-12 d-flex align-items-center justify-content-end">
            <button class="btn btn-link outline-none"
                    tooltip="{{langService.map.print}}"
                    (click)="printResult()">
              <i class="mdi mdi-printer"></i></button>
          </div>
        </div>
        <table class="table table-striped table-bordered caption-top">
          <thead role="rowgroup">
          <tr>
            <th class="serial-column">{{langService.map.request_number}}</th>
            <th class="date-column">{{langService.map.request_date}}</th>
            <th>{{langService.map.lbl_org_unit}}</th>
            <th>{{langService.map.request_status}}</th>
            <th>{{langService.map.request_aid_amount}}</th>
            <th>{{langService.map.total_approved_amount}}</th>
            <th>{{langService.map.lbl_actions}}</th>
          </tr>
          </thead>
          <tbody>
          <ng-container *ngFor="let request of requests;">
            <tr>
              <td class="serial-column">
                <div class="d-flex flex-row">
                  <span class="dir-ltr d-inline-block flex-grow-1 text-start"> {{request.requestFullSerial}} </span>
                </div>
              </td>
              <td class="date-column"> {{request.creationDate|date}} </td>
              <td> {{request.orgAndBranchInfo?.getName()}} </td>
              <td> {{request.statusInfo.getName()}} </td>
              <td> {{request.requestedAidAmount | mask:inputMaskPatterns.SEPARATOR:inputMaskPatterns.THOUSAND_SEPARATOR}} </td>
              <td> {{request.approvedAmount | mask:inputMaskPatterns.SEPARATOR:inputMaskPatterns.THOUSAND_SEPARATOR}} </td>
              <td class="table-actions">
                <div class="d-flex flex-row">
                  <a tooltip="{{langService.map.show_aids}}" href="#" class="icon-btn"
                     (click)="request.showAid($event)">
                    <span class="badge bg-primary aid-badge">{{request.aidCount}}</span>
                  </a>
                  <a href="#" (click)="printRequest($event, request)"
                     tooltip="{{langService.map.print_request_form}}" class="icon-btn">
                    <i class="mdi mdi-printer"></i>
                  </a>
                  <a href="#" (click)="request.showLog($event)" tooltip="{{langService.map.show_logs}}"
                     class="icon-btn">
                    <i class="mdi mdi-history"></i>
                  </a>
                </div>
              </td>
            </tr>
          </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
