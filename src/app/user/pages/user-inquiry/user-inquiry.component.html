<fieldset class="mb-4">
  <legend><span class="h6 text-primary">{{langService.map.menu_inquiries}}</span></legend>
  <form [formGroup]="form" autocomplete="off" action="#">
    <!--  Inquiry Types  -->
    <div class="row">
      <div class="col mb-4">
        <div class="form-check form-check-inline">
          <input formControlName="inquiryType" [value]="false" class="form-check-input" type="radio"
                 name="inquiryType"
                 id="inquiryByName">
          <label class="form-check-label" for="inquiryByName">
            {{langService.map.inquiry_by_name}}
          </label>
        </div>
        <div class="form-check form-check-inline">
          <input formControlName="inquiryType" [value]="true" class="form-check-input" type="radio" name="inquiryType"
                 id="inquiryById">
          <label class="form-check-label" for="inquiryById">
            {{langService.map.inquiry_by_id}}
          </label>
        </div>
      </div>
    </div>
    <!-- Search By Name -->
    <div formGroupName="searchByName" *ngIf="!displayIdCriteria" class="row">
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="searchMethod">{{langService.map.search_method}}</label>
          <!--<select formControlName="operator" class="form-select" id="searchMethod" name="idType">
            <option [value]="option.lookupKey" *ngFor="let option of stringOperators">{{option.getName()}}</option>
          </select>-->
          <ng-select [selectOnTab]="true" labelForId="searchMethod" [clearable]="false"
                     placeholder="{{langService.map.select}}" id="searchMethod"
                     [notFoundText]="langService.map.msg_not_found"
                     formControlName="operator">
            <ng-option *ngFor="let option of stringOperators" [value]="option.lookupKey">
              {{option.getName()}}
            </ng-option>
          </ng-select>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4">
          <label for="arName">{{langService.map.arabic_name}}</label>
          <input type="text" formControlName="arName" id="arName" class="form-control">
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4">
          <label for="enName">{{langService.map.english_name}}</label>
          <input type="text" formControlName="enName" id="enName" class="form-control" name="enName">
        </div>
      </div>
    </div>
    <!-- Search By Id  -->
    <div formGroupName="searchById" *ngIf="displayIdCriteria" class="row flex-sm-column flex-md-row">
      <div class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="idType">{{langService.map.id_type}}</label>
          <!--<select formControlName="benPrimaryIdType" class="form-select" id="idType" name="idType">
            <option [ngValue]="option.lookupKey" *ngFor="let option of idTypes">{{option.getName()}}</option>
          </select>-->
          <ng-select [selectOnTab]="true" labelForId="idType" [clearable]="false"
                     placeholder="{{langService.map.select}}" id="idType"
                     [notFoundText]="langService.map.msg_not_found"
                     formControlName="benPrimaryIdType">
            <ng-option *ngFor="let option of idTypes" [value]="option.lookupKey">
              {{option.getName()}}
            </ng-option>
          </ng-select>
        </div>
      </div>
      <div class="col flex-grow-1">
        <div class="mb-4 position-relative">
          <label for="text">{{langService.map.id_number}}</label>
          <input [ngClass]="fm.getInvalidClass('searchById.benPrimaryIdNumber')" type="text"
                 formControlName="benPrimaryIdNumber" id="text" class="form-control"
                 name="benPrimaryIdNumber">
          <app-field-error-message
            [control]="fm.getFormField('searchById.benPrimaryIdNumber')"></app-field-error-message>
        </div>
      </div>
      <div *ngIf="displayNationality" class="col flex-grow-1">
        <div class="mb-4 ng-select-wrapper">
          <label for="nationality">{{langService.map.lbl_nationality}}</label>
          <!--<select formControlName="benPrimaryIdNationality" id="nationality" class="form-select">
            <option [ngValue]="option.lookupKey" *ngFor="let option of nationalities">{{option.getName()}}</option>
          </select>-->
          <ng-select [selectOnTab]="true" labelForId="nationality" [clearable]="false"
                     placeholder="{{langService.map.select}}" id="nationality"
                     [notFoundText]="langService.map.msg_not_found"
                     formControlName="benPrimaryIdNationality">
            <ng-option *ngFor="let option of nationalities" [value]="option.lookupKey">
              {{option.getName()}}
            </ng-option>
          </ng-select>
        </div>
      </div>
    </div>
    <!-- Form Button -->
    <div class="row">
      <div class="col d-flex flex-row justify-content-start">
        <button (click)="search()" [disabled]="currentForm?.invalid"
                class="btn shadow-sm btn-primary">{{langService.map.lbl_search}}</button>
        <button (click)="resetCurrentForm()"
                class="btn shadow-sm btn-secondary mx-3">{{langService.map.btn_clear}}</button>
      </div>
    </div>
  </form>
</fieldset>
<div *ngIf="!!beneficiary" class="row">
  <div class="col-12">
    <div><h1 class="h6 text-primary">{{langService.map.personal_info}}</h1></div>
    <div class="table-responsive column-style">
      <table class="table table-bordered caption-top">
        <tbody>
        <tr>
          <th>{{langService.map.arabic_name}}</th>
          <td>{{beneficiary?.arName}}</td>
          <th>{{langService.map.employer}}</th>
          <td>{{beneficiary?.employeer}}</td>
        </tr>
        <tr>
          <th>{{langService.map.lbl_nationality}}</th>
          <td>{{beneficiary?.benPrimaryIdNationalityInfo?.getName()}}</td>
          <th>{{langService.map.id_type}}</th>
          <td>{{beneficiary?.benPrimaryIdTypeInfo?.getName()}}</td>
        </tr>
        <tr>
          <th>{{langService.map.gender}}</th>
          <td>{{beneficiary?.genderInfo?.getName()}}</td>
          <th>{{langService.map.date_of_birth}}</th>
          <td>{{beneficiary?.dateOfBirthString|date}}</td>
        </tr>
        <tr>
          <th>{{langService.map.sponsors_count}}</th>
          <td class="position-relative">
            <div class="d-flex align-items-center flex-row h-100 w-100">
              <span>{{beneficiary?.benDependentsCount}}</span><span class="flex-grow-1"></span>
              <button disabled class="btn btn-sm btn-primary shadow-sm">{{langService.map.show_details}}</button>
            </div>
          </td>
        </tr>
        </tbody>
      </table><!-- table -->
    </div><!-- table container-->
  </div>
</div><!-- -->
<!--  we hide this part cause there is no integration with MOI yet -->
<div *ngIf="false" class="row">
  <div class="col-12">
    <div><h6>{{langService.map.family_info}}</h6></div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered caption-top">
        <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Relation</th>
          <th scope="col">ID Number</th>
          <th scope="col">ID type</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        <tr>
          <td>Ahmed Mohamed Mostafa Ismail</td>
          <td>Son</td>
          <td>30697114</td>
          <td>Passport</td>
        </tr>
        </tbody>
      </table><!-- table -->
    </div><!-- table container-->
  </div>
</div>
<div *ngIf="requests.length" class="row">
  <div class="col">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="personal-aid-tab" data-bs-toggle="tab" href="#personal-aid" role="tab"
           aria-controls="personal-aids" aria-selected="true">{{langService.map.personal_aid}}</a>
      </li>
    </ul>
    <div class="tab-content py-3">
      <div class="tab-pane fade show active" id="personal-aid" role="tabpanel" aria-labelledby="personal-aid-tab">
        <div class="row">
          <div class="col-12 d-flex align-items-center justify-content-end">
            <button class="btn btn-link outline-none"
                    tooltip="{{langService.map.print}}"
                    (click)="printResult()">
              <i class="mdi mdi-printer"></i></button>
          </div>
        </div>
        <table class="table table-striped table-bordered caption-top">
          <thead role="rowgroup">
          <tr>
            <th>{{langService.map.request_number}}</th>
            <th class="date-column">{{langService.map.request_date}}</th>
            <th>{{langService.map.lbl_org_unit}}</th>
            <th>{{langService.map.aid_status}}</th>
            <th>{{langService.map.request_aid_amount}}</th>
            <th>{{langService.map.aid_type}}</th>
            <th>{{langService.map.approved_aid_amount}}</th>
            <th>{{langService.map.lbl_actions}}</th>
          </tr>
          </thead>
          <tbody>
          <ng-container *ngFor="let request of requests;">
            <div *ngIf="request.aids && request.aids.length > 0; then multiAidRow else noAidRow"></div>
            <ng-template #multiAidRow>
              <tr *ngFor="let aid of request.aids; let firstAid = first;">
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"><span
                  class="dir-ltr d-inline-block"> {{request.requestFullSerial}} </span></td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length" class="date-column"> {{request.creationDate|date}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"> {{request.orgBranchInfo.getName()}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length"> {{request.statusInfo.getName()}} </td>
                <td *ngIf="firstAid"
                    [rowSpan]="request.aids.length"> {{request.requestedAidAmount | mask:'separator':','}} </td>
                <td> {{aid.aidLookupInfo.getName()}} </td>
                <td> {{aid.aidAmount | mask:'separator':','}} </td>
                <td *ngIf="firstAid" [rowSpan]="request.aids.length" class="table-actions">
                  <div class="d-flex flex-row">
                    <a tooltip="{{langService.map.show_aids}}" href="#" class="icon-btn">
                      <span class="badge bg-primary" (click)="request.showAid($event)">{{request.aidCount}}</span>
                    </a>
                    <a href="#" (click)="printRequest($event, request)"
                       tooltip="{{langService.map.print_request_form}}" class="icon-btn">
                      <i class="mdi mdi-printer"></i>
                    </a>
                    <a href="#" (click)="request.showLog($event)" tooltip="{{langService.map.show_logs}}"
                       class="icon-btn">
                      <i class="mdi mdi-history"></i>
                    </a>
                    <!--<a href="#" (click)="request.showAid($event)" tooltip="{{langService.map.show_aids}}"
                       class="icon-btn">
                      <i class="mdi mdi-heart-multiple"></i>
                    </a>-->
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template #noAidRow>
              <tr>
                <td><span class="dir-ltr d-inline-block"> {{request.requestFullSerial}} </span></td>
                <td class="date-column"> {{request.creationDate|date}} </td>
                <td> {{request.orgBranchInfo.getName()}} </td>
                <td> {{request.statusInfo.getName()}} </td>
                <td> {{request.requestedAidAmount | mask:'separator':','}} </td>
                <td></td>
                <td></td>
                <td class="table-actions">
                  <div class="d-flex flex-row">
                    <a tooltip="{{langService.map.show_aids}}" href="#" class="icon-btn">
                      <span class="badge bg-primary" (click)="request.showAid($event)">{{request.aidCount}}</span>
                    </a>
                    <a href="#" (click)="printRequest($event, request)"
                       tooltip="{{langService.map.print_request_form}}" class="icon-btn">
                      <i class="mdi mdi-printer"></i>
                    </a>
                    <a href="#" (click)="request.showLog($event)" tooltip="{{langService.map.show_logs}}"
                       class="icon-btn">
                      <i class="mdi mdi-history"></i>
                    </a>
                    <!--<a href="#" (click)="request.showAid($event)" tooltip="{{langService.map.show_aids}}"
                       class="icon-btn">
                      <i class="mdi mdi-heart-multiple"></i>
                    </a>-->
                  </div>
                </td>
              </tr>
            </ng-template>
          </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
