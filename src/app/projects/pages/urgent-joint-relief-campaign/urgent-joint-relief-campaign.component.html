<div class="row">
  <tabs-list [accordionView]="accordionView">
    <tab name="basic_info" [hasError]="basicInfo.invalid" [template]="basic_info" [title]="lang.map.lbl_basic_info">
    </tab>
    <tab [hasError]="specialExplanation.invalid" name="participant_organizations" [template]="participant_organizations"
         [title]="lang.map.participant_organizations"></tab>
    <tab [hasError]="specialExplanation.invalid" name="special_explanations" [template]="special_explanations"
         [title]="lang.map.special_explanations"></tab>
    <tab name="attachments" *ngIf="!accordionView" [template]="attachmentsTab" [title]="lang.map.attachments"></tab>
  </tabs-list>
  <ng-container [formGroup]="form">
    <ng-container formGroupName="basicInfo">
      <ng-template #basic_info>
        <div class="row">
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="fullName"
                   for="fullName">{{lang.map.campaign_name}}</label>
            <input id="fullName" validationClasses="fullName" formControlName="fullName"
                   class="form-control">
            <app-field-error-message controlName="fullName"></app-field-error-message>
          </div>
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label for="licenseStartDate" asteriskIfRequired="licenseStartDate"
                   class="form-label">{{lang.map.campaign_start_date}}</label>
            <div class="reg-start-date-container">
              <div class="input-group">
                <i class="input-group-text mdi mdi-calendar"></i>
                <div class="form-control"
                     formControlName="licenseStartDate"
                     id="licenseStartDate"
                     (click)="dpLicenseStartDate.toggleCalendar()"
                     #dpLicenseStartDate="angular-mydatepicker"
                     [options]="datepickerOptionsMap.licenseStartDate"
                     angular-mydatepicker validationClasses="licenseStartDate"></div>
                <app-field-error-message [control]="fm.getFormField('licenseStartDate')"></app-field-error-message>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label for="licenseEndDate" asteriskIfRequired="licenseEndDate"
                   class="form-label">{{lang.map.campaign_end_date}}</label>
            <div class="reg-start-date-container">
              <div class="input-group">
                <i class="input-group-text mdi mdi-calendar"></i>
                <div class="form-control"
                     formControlName="licenseEndDate"
                     id="licenseEndDate"
                     (click)="dpLicenseEndDate.toggleCalendar()"
                     #dpLicenseEndDate="angular-mydatepicker"
                     [options]="datepickerOptionsMap.licenseEndDate"
                     angular-mydatepicker validationClasses="licenseEndDate"></div>
                <app-field-error-message [control]="fm.getFormField('licenseEndDate')"></app-field-error-message>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="beneficiaryCountry"
                   for="beneficiaryCountry">{{lang.map.beneficiary_country}}</label>
            <ng-select validationClasses="beneficiaryCountry" appendTo="body" [clearable]="false" id="beneficiaryCountry"
                       formControlName="beneficiaryCountry">
              <ng-option [value]="option.id" *ngFor="let option of countries">{{option.getName()}}</ng-option>
            </ng-select>
            <app-field-error-message controlName="beneficiaryCountry"></app-field-error-message>
          </div>
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="targetAmount"
                   for="targetAmount">{{lang.map.target_amount}}</label>
            <input id="targetAmount" validationClasses="targetAmount" formControlName="targetAmount"
                   class="form-control">
            <app-field-error-message controlName="targetAmount"></app-field-error-message>
          </div>
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="approvalPeriod"
                   for="approvalPeriod">{{lang.map.approval_period}}</label>
            <input id="approvalPeriod" validationClasses="approvalPeriod" formControlName="approvalPeriod"
                   class="form-control">
            <app-field-error-message controlName="approvalPeriod"></app-field-error-message>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="phone"
                   for="phone">{{lang.map.lbl_phone}}</label>
            <input id="phone" validationClasses="phone" formControlName="phone"
                   class="form-control">
            <app-field-error-message controlName="phone"></app-field-error-message>
          </div>
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="extraPhone"
                   for="extraPhone">{{lang.map.lbl_extra_phone_number}}</label>
            <input id="extraPhone" validationClasses="extraPhone" formControlName="extraPhone"
                   class="form-control">
            <app-field-error-message controlName="extraPhone"></app-field-error-message>
          </div>
        </div>
      </ng-template>
    </ng-container>
    <ng-container>
      <ng-template #participant_organizations>
        <div class="row">
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label"
                   for="selectedOrg">{{lang.map.menu_organizations}}</label>
            <ng-select appendTo="body" [clearable]="true"
                       id="selectedOrg"
                       ng-model="selectedOrg"
                       (change)="onChangeSelectedOrganization($event)">
              <ng-option [value]="option.id"
                         *ngFor="let option of organizationUnits">{{option.getName()}}</ng-option>
            </ng-select>
          </div>
          <div class="col-md-4 col-sm-12 mb-4 position-relative">
            <label class="form-label"></label>
            <button (click)="addOrganization()"
                    [disabled]="!selectedOrg"
                    class="btn btn-primary">{{lang.map.add_organization}}</button>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <app-table #table [useSearchToFilter]="true"
                       [selectable]="true" [data]="selectedOrganizationUnits" [columns]="organizationDisplayedColumns"
                       sortableTable>
              <table cdk-table [dataSource]="table.dataSource"
                     class="table table-striped table-bordered caption-top">
                <ng-container cdkColumnDef="arName">
                  <th cdk-header-cell sortable-header *cdkHeaderCellDef> {{lang.map.arabic_name}}</th>
                  <td cdk-cell *cdkCellDef="let row"> {{row.arName}} </td>
                </ng-container>
                <ng-container cdkColumnDef="enName">
                  <th cdk-header-cell sortable-header *cdkHeaderCellDef> {{lang.map.english_name}}</th>
                  <td cdk-cell *cdkCellDef="let row"> {{row.enName}} </td>
                </ng-container>
                <ng-container cdkColumnDef="actions">
                  <th cdk-header-cell *cdkHeaderCellDef> {{lang.map.lbl_actions}}</th>
                  <td cdk-cell *cdkCellDef="let row" class="table-actions">
                    <div class="d-flex flex-row">
                      <a href="#" (click)="removeOrganization($event, row)" tooltip="{{lang.map.btn_remove}}"
                         class="icon-btn">
                        <i class="mdi mdi-close-box"></i>
                      </a>
                    </div>
                  </td>
                </ng-container>
                <tr cdk-header-row *cdkHeaderRowDef="organizationDisplayedColumns"></tr>
                <tr cdk-row *cdkRowDef="let row; columns: organizationDisplayedColumns;"></tr>
                <!--suppress HtmlUnknownBooleanAttribute -->
                <tr *cdkNoDataRow>
                  <td colspan="100" class="text-center">{{lang.map.no_records_to_display}}</td>
                </tr>
              </table>
            </app-table>
          </div>
        </div>
      </ng-template>
    </ng-container>
    <ng-container formGroupName="explanation">
      <ng-template #special_explanations>
        <div class="row">
          <div class="col-sm-12 mb-4 position-relative">
            <label class="form-label" asteriskIfRequired="description"
                   for="description">{{lang.map.special_explanations}}</label>
            <textarea name="description" formControlName="description" validationClasses="description" id="description"
                      rows="4" class="form-control"></textarea>
            <app-field-error-message controlName="description"></app-field-error-message>
          </div>
        </div>
      </ng-template>
    </ng-container>
  </ng-container>
  <ng-template #attachmentsTab>
    <attachments [caseId]="model?.id" [caseType]="model?.caseType"
                 [service]="service.documentService"></attachments>
  </ng-template>
</div>
