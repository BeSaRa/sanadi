<div>
  <div class="d-flex flex-row justify-content-start align-items-center mb-3">
    <h1 class="h6 text-primary">{{lang.map.attachments}}</h1>
    <div>
      <button [tooltip]="lang.map.btn_reload" (click)="reload()" class="btn text-primary icon-btn">
        <i class="mdi mdi-reload"></i>
      </button>
    </div>
  </div>
  <app-table [selectable]="true" #table sortableTable [paginator]="paginator"
             [filter]="filter.value"
             [data]="attachments"
             [columns]="displayedColumns">
    <table cdk-table [dataSource]="table.dataSource" class="table table-striped table-bordered caption-top">
      <ng-container cdkColumnDef="select">
        <th cdk-header-cell class="bg-primary" style="width: 20px;" *cdkHeaderCellDef>
          <input type="checkbox"
                 [indeterminate]="table.selection.hasValue() && !table.allSelected()"
                 (change)="$event ? table.toggleAll() : null"
                 [checked]="table.selection.hasValue() && table.allSelected()"
                 class="form-check-input"></th>
        <td cdk-cell *cdkCellDef="let row">
          <input type="checkbox"
                 (click)="$event.stopPropagation()"
                 [checked]="table.selection.isSelected(row)"
                 (change)="$event ? table.selection.toggle(row) : null"
                 class="form-check-input"></td>
      </ng-container>
      <ng-container cdkColumnDef="title">
        <th cdk-header-cell class="bg-primary text-white" style="width: 20px;" *cdkHeaderCellDef></th>
        <td cdk-cell *cdkCellDef="let row"><i class="mdi text-primary mdi-file-pdf"></i></td>
      </ng-container>
      <ng-container cdkColumnDef="type">
        <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.attachment_type}}</th>
        <td cdk-cell *cdkCellDef="let row"> {{row.attachmentTypeInfo.getName()}} </td>
      </ng-container>
      <ng-container cdkColumnDef="description">
        <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.lbl_description}}</th>
        <td cdk-cell *cdkCellDef="let row"> {{row.description}} </td>
      </ng-container>
      <ng-container cdkColumnDef="mandatory">
        <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.lbl_mandatory}}</th>
        <td cdk-cell *cdkCellDef="let row"> {{row.getRequiredTranslate()}} </td>
      </ng-container>
      <ng-container cdkColumnDef="date">
        <th cdk-header-cell class="bg-primary text-white" *cdkHeaderCellDef> {{lang.map.creation_date}}</th>
        <td cdk-cell *cdkCellDef="let row"> {{row.createdOn|date: 'mediumDate' }} </td>
      </ng-container>
      <ng-container cdkColumnDef="actions">
        <th cdk-header-cell style="width: 200px" class="bg-primary text-white"
            *cdkHeaderCellDef> {{lang.map.lbl_actions}}</th>
        <td cdk-cell *cdkCellDef="let row">
          <div class="d-flex gap-2">
            <button [disabled]="disabled" [tooltip]="row.id ? lang.map.update_file : lang.map.upload_file"
                    (click)="uploadAttachment(row , uploader)"
                    [class.btn-success]="row.id"
                    class="btn shadow-sm btn-secondary d-flex align-items-center justify-content-start">
              <i [class.mdi-progress-upload]="row.id" [class.mdi-upload]="!row.id" class="mdi mdi-upload"></i>
            </button>
            <button [tooltip]="lang.map.view" (click)="viewFile(row)"
                    [disabled]="!row.id"
                    class="btn shadow-sm btn-info d-flex align-items-center justify-content-start">
              <i [class.mdi-eye-off]="!row.id" [class.mdi-eye]="row.id" class="mdi text-white"></i>
            </button>
            <button [tooltip]="lang.map.btn_delete" (click)="deleteFile(row)"
                    [disabled]="disabled"
                    class="btn shadow-sm btn-danger d-flex align-items-center justify-content-start">
              <i [class.mdi-delete-off]="!row.id" [class.mdi-delete]="row.id" class="mdi"></i>
            </button>
          </div>
        </td>
      </ng-container>
      <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>
      <tr cdk-row *cdkRowDef="let row; columns: displayedColumns;"></tr>
      <tr *cdkNoDataRow>
        <td colspan="20">{{lang.map.no_records_to_display}}</td>
      </tr>
    </table>
  </app-table>
  <input type="file" (change)="uploaderFileChange($event)" #uploader id="attachmentUploader" class="visually-hidden">
  <app-paginator #paginator></app-paginator>
</div>
